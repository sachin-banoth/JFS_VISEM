<!DOCTYPE html>
<html>
<head>
    <title>Batch & Faculty Timetable</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        body { font-family: Arial, sans-serif; padding: 12px; }

        table {
            width: 80%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            background: lightblue;
        }
        .title {
            font-weight: bold;
            font-size: 22px;
            margin-top: 20px;
        }
        button {
            padding: 8px 16px;
            margin-right: 10px;
            margin-top: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h2>Upload CSV File</h2>
<input type="file" id="csvFile" accept=".csv">

<br><br>

<button onclick="showBatchSection()">Show Batch Timetable</button>
<button onclick="showFacultySection()">Show Faculty Timetable</button>

<div id="batchSection">
    <h2>Batch-wise Timetable</h2>
    <div id="batchTables"></div>
</div>

<div id="facultySection" style="display:none;">
    <h2>Faculty Timetable </h2>

    <select id="facultySelect">
        <option value="">-- Select Faculty --</option>
    </select>

    <div id="facultyTable"></div>
</div>

<script>
function clean(value) {
    return value ? String(value).trim() : "";
}

function cleanDay(d) {
    if (!d) return "";
    d = d.trim().toUpperCase();
    if (d.startsWith("MON")) return "MON";
    if (d.startsWith("TUE")) return "TUE";
    if (d.startsWith("WED")) return "WED";
    if (d.startsWith("THU")) return "THU";
    if (d.startsWith("FRI")) return "FRI";
    if (d.startsWith("SAT")) return "SAT";
    return "";
}

function cleanSession(s) {
    s = clean(s).toUpperCase();
    if (s.startsWith("F")) return "FN";
    if (s.startsWith("A")) return "AN";
    return "";
}

let batchTable = {};
let facultyTable = {};

document.getElementById("csvFile").addEventListener("change", function () {
    Papa.parse(this.files[0], {
        header: true,
        skipEmptyLines: true,
        complete: (result) => processCSV(result.data)
    });
});

function processCSV(rows) {
    batchTable = {};
    facultyTable = {};

    rows.forEach(r => {
        const batch = clean(r["BATCH"]);
        const day = cleanDay(r["DAY"]);
        const session = cleanSession(r["SESSION"]);
        const course = clean(r["COURSE"]);
        const room = clean(r["ROOM"]);
        const faculty = clean(r["FACULTY"]);

        if (!batch || !day || !session) return;

        // BATCH TABLE
        if (!batchTable[batch]) batchTable[batch] = {};
        if (!batchTable[batch][day]) batchTable[batch][day] = { FN: "", AN: "" };
        batchTable[batch][day][session] =
            `${course}<br>Room: ${room}<br>Faculty: ${faculty}`;

        // FACULTY TABLE
        if (!facultyTable[faculty]) facultyTable[faculty] = {};
        if (!facultyTable[faculty][day]) facultyTable[faculty][day] = { FN: "", AN: "" };
        facultyTable[faculty][day][session] =
            `${course}<br>Batch: ${batch}<br>Room: ${room}`;
    });

    buildBatchTables();
    loadFacultyDropdown();
}

function buildBatchTables() {
    const container = document.getElementById("batchTables");
    container.innerHTML = "";

    const days = ["MON", "TUE", "WED", "THU", "FRI", "SAT"];

    Object.keys(batchTable).forEach(batch => {
        const title = document.createElement("div");
        title.className = "title";
        title.innerHTML = `Batch: ${batch}`;
        container.appendChild(title);

        const table = document.createElement("table");
        let html = `<tr>
                        <th>DAY</th>
                        <th>FN</th>
                        <th rowspan="7">L<br>U<br>N<br>C<br>H</th>
                        <th>AN</th>
                    </tr>`;

        days.forEach(day => {
            const fn = batchTable[batch][day]?.FN || "";
            const an = batchTable[batch][day]?.AN || "";
            html += `<tr>
                        <td>${day}</td>
                        <td>${fn}</td>
                        <td>${an}</td>
                     </tr>`;
        });

        table.innerHTML = html;
        container.appendChild(table);
    });
}
function loadFacultyDropdown() {
    const select = document.getElementById("facultySelect");
    select.innerHTML = `<option value="">-- Select Faculty --</option>`;

    Object.keys(facultyTable).forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
    });

    select.addEventListener("change", () => {
        showFacultyTable(select.value);
    });
}

function showFacultyTable(facultyName) {
    const container = document.getElementById("facultyTable");
    container.innerHTML = "";

    if (!facultyName) return;

    const data = facultyTable[facultyName];
    const days = ["MON", "TUE", "WED", "THU", "FRI", "SAT"];

    const title = document.createElement("div");
    title.className = "title";
    title.innerHTML = `Faculty: ${facultyName}`;
    container.appendChild(title);

    const table = document.createElement("table");
    let html = `<tr>
                    <th>DAY</th>
                    <th>FN</th>
                    <th rowspan="7">L<br>U<br>N<br>C<br>H</th>
                    <th>AN</th>
                </tr>`;

    days.forEach(day => {
        const fn = data[day]?.FN || "";
        const an = data[day]?.AN || "";
        html += `<tr>
                    <td>${day}</td>
                    <td>${fn}</td>
                    <td>${an}</td>
                 </tr>`;
    });

    table.innerHTML = html;
    container.appendChild(table);
}

function showBatchSection() {
    document.getElementById("batchSection").style.display = "block";
    document.getElementById("facultySection").style.display = "none";
}

function showFacultySection() {
    document.getElementById("batchSection").style.display = "none";
    document.getElementById("facultySection").style.display = "block";
}
</script>

</body>
</html>
